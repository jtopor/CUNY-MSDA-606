---
title: "Inference for numerical data"
output:
  pdf_document: default
  html_document:
    css: ./lab.css
    highlight: pygments
    theme: cerulean
---

```{r, echo=FALSE}
setwd("C:/Users/Hammer/Documents/Lab5")
```
## North Carolina births

In 2004, the state of North Carolina released a large data set containing 
information on births recorded in this state. This data set is useful to 
researchers studying the relation between habits and practices of expectant 
mothers and the birth of their children. We will work with a random sample of 
observations from this data set.

## Exploratory analysis

Load the `nc` data set into our workspace.

```{r load-data, eval=TRUE}
load("more/nc.RData")
```

We have observations on 13 different variables, some categorical and some 
numerical. The meaning of each variable is as follows.

variable         | description
---------------- | -----------
`fage`           | father's age in years.
`mage`           | mother's age in years.
`mature`         | maturity status of mother.
`weeks`          | length of pregnancy in weeks.
`premie`         | whether the birth was classified as premature (premie) or full-term.
`visits`         | number of hospital visits during pregnancy.
`marital`        | whether mother is `married` or `not married` at birth.
`gained`         | weight gained by mother during pregnancy in pounds.
`weight`         | weight of the baby at birth in pounds.
`lowbirthweight` | whether baby was classified as low birthweight (`low`) or not (`not low`).
`gender`         | gender of the baby, `female` or `male`.
`habit`          | status of the mother as a `nonsmoker` or a `smoker`.
`whitemom`       | whether mom is `white` or `not white`.



1.  What are the cases in this data set? How many cases are there in our sample?


```{r}
nrow(nc)
```
The cases in the data set are information on births within the State of North Carolina for the year 2004. The output of R's __nrow__ function (above) shows that there are 1000 cases in the sample.


As a first step in the analysis, we should consider summaries of the data. This
can be done using the `summary` command:

```{r}
summary(nc)
```

As you review the variable summaries, consider which variables are categorical 
and which are numerical. For numerical variables, are there outliers? If you 
aren't sure or want to take a closer look at the data, make a graph.

Consider the possible relationship between a mother's smoking habit and the 
weight of her baby. Plotting the data is a useful first step because it helps 
us quickly visualize trends, identify strong associations, and develop research
questions.



2.  Make a side-by-side boxplot of `habit` and `weight`. What does the plot highlight about the relationship between these two variables?

```{r}
boxplot(nc$weight ~ nc$habit, ylab = "Weight")
```

The box plots show that the median weight of a smoker is a bit less than that of a non-smoker. 

The box plots show how the medians of the two distributions compare, but we can
also compare the means of the distributions using the following function to 
split the `weight` variable into the `habit` groups, then take the mean of each
using the `mean` function.

```{r by-means, eval=TRUE}
by(nc$weight, nc$habit, mean)
```

There is an observed difference, but is this difference statistically 
significant? In order to answer this question we will conduct a hypothesis test
.

## Inference

3.  Check if the conditions necessary for inference are satisfied. Note that you will need to obtain sample sizes to check the conditions. You can compute the group size using the same `by` command above but replacing `mean` with `length`.

-  __Samples must be independent events:__ TRUE
-  __Samples must be randomly selected:__ TRUE
-  __Sample size must be less than 10% of the population:__ We'll check this using the 'by' command:

```{r}
by(nc$weight, nc$habit, length)
```

TRUE (assuming North Carolina had at least 8,730 birthmothers who did not smoke in 2004 and 1,260 birthmothers who did smoke in 2004).

-  __The distribution of original population cannot be heavily skewed.__

TRUE. As shown in the following plots, the distribution is left skewed. However, the sample size of 1000 is sufficiently large to allow us to use a normal approximation.
```{r}
hist(nc$weight)
qqnorm(nc$weight)
qqline(nc$weight)
```



4.  Write the hypotheses for testing if the average weights of babies born to smoking and non-smoking mothers are different.

__H0: mu(weight of baby born to smoking mother) - mu(weight of baby born to nonsmoking mother) = 0__  
There is no difference in average birth weight for newborns from mothers who did and did not smoke.  

__HA: mu(weight of baby born to smoking mother) - mu(weight of baby born to nonsmoking mother) ! = 0__  
There is a difference in average birth weight for newborns from mothers who did and did not smoke.

Next, we introduce a new function, `inference`, that we will use for conducting
hypothesis tests and constructing confidence intervals. 

```{r inf-weight-habit-ht, eval=TRUE, tidy=FALSE}
inference(y = nc$weight, x = nc$habit, est = "mean", type = "ht", null = 0, 
          alternative = "twosided", method = "theoretical")
```

Let's pause for a moment to go through the arguments of this custom function. 
The first argument is `y`, which is the response variable that we are 
interested in: `nc$weight`. The second argument is the explanatory variable, 
`x`, which is the variable that splits the data into two groups, smokers and 
non-smokers: `nc$habit`. The third argument, `est`, is the parameter we're 
interested in: `"mean"` (other options are `"median"`, or `"proportion"`.) Next
we decide on the `type` of inference we want: a hypothesis test (`"ht"`) or a 
confidence interval (`"ci"`). When performing a hypothesis test, we also need 
to supply the `null` value, which in this case is `0`, since the null 
hypothesis sets the two population means equal to each other. The `alternative`
hypothesis can be `"less"`, `"greater"`, or `"twosided"`. Lastly, the `method` 
of inference can be `"theoretical"` or `"simulation"` based.

5.  Change the `type` argument to `"ci"` to construct and record a confidence interval for the difference between the weights of babies born to smoking and non-smoking mothers.

```{r, tidy=FALSE}
inference(y = nc$weight, x = nc$habit, est = "mean", type = "ci", null = 0, 
          alternative = "twosided", method = "theoretical")
```
The 95% confidence interval is (0.0534, 0.5777) for the difference between the weights of babies born to smoking and non-smoking mothers. It tells us that we are 95% confident that the actual difference in average birth weights between smoking and non-smoking mothers within the total population should be between 0.0534 and 0.5777 pounds.

By default the function reports an interval for ($\mu_{nonsmoker} - \mu_{smoker}$)
. We can easily change this order by using the `order` argument:

```{r, tidy=FALSE}
inference(y = nc$weight, x = nc$habit, est = "mean", type = "ci", null = 0, 
          alternative = "twosided", method = "theoretical", 
          order = c("smoker","nonsmoker"))
```

* * *

## On your own

-   Calculate a 95% confidence interval for the average length of pregnancies 
(`weeks`) and interpret it in context. Note that since you're doing inference 
on a single population parameter, there is no explanatory variable, so you can 
omit the `x` variable from the function.

```{r, tidy=FALSE}
inference(y = nc$weeks, est = "mean", type = "ci", method = "theoretical")
```
__The confidence interval (38.1528, 38.5165) tells us that 95% of the sample means for the "weeks" variable should fall between 38.1528 and 38.5165.__

__It also tells us that we are 95% confident that the average number of weeks for the population should be between 38.1528 and 38.5165.__


-   Calculate a new confidence interval for the same parameter at the 90% 
confidence level. You can change the confidence level by adding a new argument 
to the function: `conflevel = 0.90`.

```{r, tidy=FALSE}
inference(y = nc$weeks, est = "mean", type = "ci", method = "theoretical", conflevel = 0.90)
```



-   Conduct a hypothesis test evaluating whether the average weight gained by 
younger mothers is different than the average weight gained by mature mothers.


```{r, tidy=FALSE}
inference(y = nc$gained, x = nc$mature, est = "mean", type = "ht", null = 0, 
          alternative = "twosided", method = "theoretical")
```

Since the P value of .1686 is greater than .05, we fail to reject the null hypothesis that the mean weights of mature and younger mothers are equivalent.


-   Now, a non-inference task: Determine the age cutoff for younger and mature 
mothers. Use a method of your choice, and explain how your method works.

To find the maximum age of younger mothers, we make use of R's __subset__ and __max__ functions, applying a boolean search limiter to the nc$mature variable:

```{r}
maxAgeYm <- max(subset(nc, mature == 'younger mom' & !is.na(mage))$mage)
maxAgeYm
```

This tells us that the maximum age of a younger mom is 34.

Now that we have the maximum age of a younger mom, we can perform a similar search using 'mature mom' as the limiting search boolean to check whether the minimum age of a mature mom is greater than the maximum age of a younger mom:

```{r}
minAgeMm <- min(subset(nc, mature == 'mature mom' & !is.na(mage))$mage)
minAgeMm
```

We see that the minimum age of a mature mom is 35, which conforms with our earlier results for the maximum age of a younger mom.


-   Pick a pair of numerical and categorical variables and come up with a 
research question evaluating the relationship between these variables. 
Formulate the question in a way that it can be answered using a hypothesis test
and/or a confidence interval. Answer your question using the `inference` 
function, report the statistical results, and also provide an explanation in 
plain language.



Research Question: Is the average weeks of pregnancy for white mothers equivalent to the average weeks of pregnancy for non-white mothers?

Our hypothesis test is stated as:  

__H0: mu(white mother) - mu(non-white mother) = 0__  
There is no difference between the average weeks of pregnancy for white mothers and non-white mothers

__HA: mu(white mother) - mu(non-white mother) != 0__  
There is a difference in the average weeks of pregnancy for white mothers and non-white mothers.

Now we apply the hypothesis test at a 95% confidence interval:
```{r, tidy=FALSE}
inference(y = nc$weeks, x = nc$whitemom, est = "mean", type = "ht", null = 0, 
          alternative = "twosided", method = "theoretical")
```

The results of the hypothesis test show a Z score of -2.672 and a p-value of .0076. The P value of .0076 is less than the .05 value we compare against for a 95% confidence interval. As such, we reject the null hypothesis and conclude that the average number of weeks of pregnancy for white mothers is not equal to the average weeks of pregnancy for non-white mothers. This result is confirmed via an examination of the side-by-side boxplots generated by the __inference__ function. It clearly shows that non-white mothers' appear to experience fewer weeks of pregnancy than do white mothers.

Now let's check to see if these results are confirmed by a confidence interval test:

```{r, tidy=FALSE}
inference(y = nc$weeks, x = nc$whitemom, est = "mean", type = "ci", null = 0, 
          alternative = "twosided", method = "theoretical")
```

The 95% confidence interval is (-1.1024, -0.1694). That is, we are 95% confident that the real difference in average weeks of pregnancy between non-white and white mothers is between -1.1 and -0.1694 weeks. Our null hypothesis __H0__ presumed a real difference of 0 weeks, a value which clearly falls outside of the 95% condifence interval we've derived here. Therefore, we should reject the __H0__, and the result of our confidence interval test has confirmed the results of our p-value test


<div id="license">
This is a product of OpenIntro that is released under a [Creative Commons 
Attribution-ShareAlike 3.0 Unported](http://creativecommons.org/licenses/by-sa/3.0).
This lab was adapted for OpenIntro by Mine &Ccedil;etinkaya-Rundel from a lab 
written by the faculty and TAs of UCLA Statistics.
</div>